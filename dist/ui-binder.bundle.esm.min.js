function g(s,e="data-"){if(!s.startsWith(e))return s;let t=s.substring(e.length);t=t.replace(/\.\./g,"__DOT_MARKER__");let r=t.split(".");for(let i=0;i<r.length;i++){let o=r[i];if(o.includes("--")){let n=[],a=o.split("--");for(let f=0;f<a.length;f++){let m=a[f];if(m.length==1){n.push(m);continue}else n.push(m.replace(/-([a-z])/gi,_=>_[1].toUpperCase()))}r[i]=n.join("-")}else if(o.length==1){r[i]=o;continue}else r[i]=o.replace(/-([a-z])/gi,n=>n[1].toUpperCase())}return t=r.join("."),t=t.replace(/__DOT_MARKER__/g,".."),t}function L(s,e="data-"){let t=[],r=Array.isArray(s)?s:s.split(".");for(let i=0;i<r.length;i++){let o=r[i];o=o.replace(/-/g,"--").replace(/\./g,".."),o=o.replace(/([A-Z])/g,"-$1").toLowerCase(),t.push(o)}return e+t.join(".")}function h(s){let t=s.replace(/\.\./g,"__DOT_MARKER__").split(".");return t=t.map(r=>r.replace(/__DOT_MARKER__/g,".")),t}function I(s){if(!Array.isArray(s))throw new Error("path must be an array of property names");let e=[];for(let t=0;t<s.length;t++){let r=s[t];r=r.replace(/\./g,"__DOT_MARKER__"),e.push(r)}return e.join(".").replace(/__DOT_MARKER__/g,"..")}function O(s){return s!=null}function y(s,e){return e.reduce((t,r)=>O(t)?t[r]:t,s)}function x(s){let e=new Map;for(let t=0;t<s.attributes.length;t++){let r=s.attributes[t];e.set(r.name,r.value)}return e}var $={contenteditable:"contentEditable",innerhtml:"innerHTML",innertext:"innerText",outerhtml:"outerHTML",outertext:"outerText",classname:"className",textcontent:"textContent"};function V(s,e="data-"){let t=s.startsWith(e)?s.substring(e.length):s;return t=t.toLowerCase(),$[t]||(t in window.Element.prototype?t:!1)}function C(s){let e=s.tagName,t=s.type||"";return e==="TEXTAREA"||e==="SELECT"?!0:e==="INPUT"?["text","password","email","search","tel","url","number","range","date","time","month","week","datetime-local","color","checkbox","radio"].includes(t):s.contentEditable==="true"||s.getAttribute("role")==="textbox"}var l={ATTRIBUTE:"data-a-",PROPERTY:"data-p-",BEHAVIOR:"data-b-",MODEL:"data-m",CLASS:"data-c"};var u=class{target="";domProperty="";event="";eventModifiers=new Map;get targetParts(){return h(this.target)}get domPropertyParts(){return h(this.domProperty)}};var v=class{reactiveClasses=new Map;computedClass=null};var d=class{attributeDirectives=new Map;propertyDirectives=new Map;behaviorDirectives=new Map;modelDirective=null;classDirective=null};function w(s){return c(s)}function T(s){let e=new v,t=s.has(l.CLASS),r=t?(s.get(l.CLASS)||"").trim():"",i=[];for(let[o]of s)o.startsWith(l.CLASS+"-")&&i.push(o);if(t&&r.length>0)e.computedClass=c(r),i.length>0&&console.warn(`Element has both ${l.CLASS} and ${i.length} ${l.CLASS}-* attributes. Only ${l.CLASS} will be used. Ignored attributes: ${i.join(", ")}`);else for(let[o,n]of s)if(o.startsWith(l.CLASS+"-")){let a=o.substring(l.CLASS.length+1);e.reactiveClasses.set(a,c(n))}return e}function A(s){let e=new u,t=s,r=t.lastIndexOf("@");r!==-1&&(e.event=t.slice(r+1),t=t.slice(0,r));let i=t.indexOf("#"),o="";i!==-1&&(o=t.slice(i+1),t=t.slice(0,i));let n=t.indexOf(":");if(n!==-1?(e.target=t.slice(0,n),e.domProperty=t.slice(n+1)):e.target=t,o){let a=P(o);for(let[f,m]of a)e.eventModifiers.set(f,m)}return e}function S(s){return c(s)}function N(s){return c(s)}function P(s){let e=[],t=s.split("#").filter(r=>r.length>0);for(let r of t){let i=r.match(/^([A-Za-z0-9_-]+)(?:\(([^)]*)\))?/);if(i){let o=i[2]?i[2].split(",").map(n=>(n=n.trim(),!isNaN(Number(n))&&n!==""?Number(n):n.toLowerCase()==="true"?!0:n.toLowerCase()==="false"?!1:n.startsWith("'")&&n.endsWith("'")||n.startsWith('"')&&n.endsWith('"')?n.slice(1,-1):n)):[];e.push([i[1],o])}}return e}function c(s){let e=new u,t=s.trim(),r=t.match(/^([A-Za-z0-9_.$\-]+[A-Za-z0-9_$\-]*)/);if(r?(e.target=r[1],t=t.slice(r[1].length)):e.target="",t.startsWith("#")){let i=P(t.slice(1));for(let[o,n]of i)e.eventModifiers.set(o,n)}else t.length>0&&e.target&&console.warn(`Unexpected characters in directive value after target: "${t}"`);return e.target||console.warn(`Could not parse target from directive value: "${s}"`),e}function R(s,e=null){let t=new d;e||(e=x(s));let r=!1;for(let[i,o]of e)if(i.startsWith(l.ATTRIBUTE)){let n=i.substring(l.ATTRIBUTE.length);t.attributeDirectives.set(n,w(o))}else if(i.startsWith(l.PROPERTY)){let n=V(i,l.PROPERTY);if(n){t.propertyDirectives.set(n,c(o));continue}let a=g(i,l.PROPERTY);t.propertyDirectives.set(a,S(o))}else if(i.startsWith(l.BEHAVIOR)){let n=i.substring(l.BEHAVIOR.length);t.behaviorDirectives.set(n,N(o))}else i===l.MODEL?C(s)?t.modelDirective=A(o):console.warn(`${l.MODEL} is not valid on ${s.tagName}${s.type?`[type="${s.type}"]`:""}`):(i.startsWith(l.CLASS+"-")||i===l.CLASS)&&(r=!0);return r&&(t.classDirective=T(e)),t}var E=class{events={};#t={"#has-listeners":[],"#no-listeners":[],"#listener-error":[]};#e=!1;logErrors=!0;get isDestroyed(){return this.#e}on(e,t){if(this.#e)throw new Error("EventEmitter is destroyed");typeof this.events[e]!="object"&&(this.events[e]=[]),this.events[e].push(t);let r=this,i=function(){r.removeListener(e,t)};return this.events[e].length==1&&this.#r("#has-listeners",e),i}#i(e,t){this.#t[e].push(t);let r=this;return function(){r.#s(e,t)}}#s(e,t){var r;typeof this.#t[e]=="object"&&(r=this.#t[e].indexOf(t),r>-1&&this.#t[e].splice(r,1))}off(e,t){return this.removeListener(e,t)}removeListener(e,t){if(!this.#e){var r;this.events[e]&&(r=this.events[e].indexOf(t),r>-1&&(this.events[e].splice(r,1),this.events[e].length==0&&this.#r("#no-listeners",e)))}}emit(e,...t){if(!this.#e&&typeof this.events[e]=="object")for(var r=this.events[e],i=r.length,o=0;o<i;o++)try{r[o].apply(this,t)}catch(n){this.#r("#listener-error",n,e,...t),this.logErrors&&console.error(`Error in listener for event "${e}":`,n)}}#r(e,...t){for(var r=this.#t[e],i=r.length,o=0;o<i;o++)try{r[o].apply(this,t)}catch(n){let a=n;if(a.cause={event:e,args:t},e==="#listener-error"){this.logErrors&&console.error(`Error in listener for internal event "${e}":`,a);continue}e==="#has-listeners"&&(this.logErrors&&console.error(`Error in listener for internal event "${e}":`,a),this.#r("#listener-error",a,"#has-listeners",...t)),e==="#no-listeners"&&(this.logErrors&&console.error(`Error in listener for internal event "${e}":`,a),this.#r("#listener-error",a,"#no-listeners",...t))}}once(e,t){return this.on(e,function r(){this.removeListener(e,r),t.apply(this,arguments)})}waitForEvent(e,t=0){if(this.#e)throw new Error("EventEmitter is destroyed");return new Promise(r=>{let i,o=this.on(e,()=>{t>0&&clearTimeout(i),o(),r(!0)});t>0&&(i=setTimeout(()=>{o(),r(!1)},t))})}waitForAnyEvent(e,t=0){if(this.#e)throw new Error("EventEmitter is destroyed");return new Promise(r=>{let i,o=[],n=()=>{t>0&&clearTimeout(i),o.forEach(a=>{a()}),r(!0)};e.forEach(a=>{o.push(this.on(a,n))}),t>0&&(i=setTimeout(()=>{n(),r(!1)},t))})}clear(){this.events={}}destroy(){this.#e||(this.#e=!0,this.#t={"#has-listeners":[],"#no-listeners":[],"#listener-error":[]},this.events={})}clearEventListeners(e){if(this.#e)return;(this.events[e]||[]).length>0&&(this.events[e]=[],this.#r("#no-listeners",e))}onHasEventListeners(e){if(this.#e)throw new Error("EventEmitter is destroyed");return this.#i("#has-listeners",e)}onNoEventListeners(e){if(this.#e)throw new Error("EventEmitter is destroyed");return this.#i("#no-listeners",e)}onListenerError(e){if(this.#e)throw new Error("EventEmitter is destroyed");return this.#i("#listener-error",e)}};var D=class{constructor(e,{config:t={},signal:r=null}){this.state=e,this.signal=r,this.config=t,this.unsubscribers=[]}get(e,t=null){let r=Array.isArray(e)?e:h(e);return y(this.state,r)??t}get isActive(){return!this.signal||!this.signal.aborted}addCleanup(e){return this.unsubscribers.push(e),this.signal&&!this.signal.aborted&&this.signal.addEventListener("abort",()=>this.dispose(),{once:!0}),e}dispose(){this.unsubscribers.forEach(e=>{try{e()}catch(t){console.warn("Error during cleanup:",t)}}),this.unsubscribers=[]}};var p={modelDirective:"modelDirective",attributeDirective:"attributeDirective",propertyDirective:"propertyDirective",classDirective:"classDirective",behaviorDirective:"behaviorDirective"},b=class{eventEmitter=new E;processElement(e,t,r={}){let i=R(e),{signal:o,config:n}=r,a=new D(t,{config:n,signal:o});return i.modelDirective&&this.eventEmitter.emit(p.modelDirective,e,i.modelDirective,a),i.attributeDirectives.size>0&&this.eventEmitter.emit(p.attributeDirective,e,i.attributeDirectives,a),i.propertyDirectives.size>0&&this.eventEmitter.emit(p.propertyDirective,e,i.propertyDirectives,a),i.classDirective&&this.eventEmitter.emit(p.classDirective,e,i.classDirective,a),i.behaviorDirectives.size>0&&this.eventEmitter.emit(p.behaviorDirective,e,i.behaviorDirectives,a),{directives:i,context:a}}onAttributeDirective(e){return this.eventEmitter.on(p.attributeDirective,e)}onModelDirective(e){return this.eventEmitter.on(p.modelDirective,e)}onPropertyDirective(e){return this.eventEmitter.on(p.propertyDirective,e)}onClassDirective(e){return this.eventEmitter.on(p.classDirective,e)}onBehaviorDirective(e){return this.eventEmitter.on(p.behaviorDirective,e)}clear(){this.eventEmitter.clear()}};var M=class{constructor(){this.boundElements=new Map,this.parser=new b;let e=this;this.parser.onAttributeDirective((t,r,i)=>{e.attributeDirectivesCallback(t,r,i)}),this.parser.onModelDirective((t,r,i)=>{e.modelDirectiveCallback(t,r,i)}),this.parser.onPropertyDirective((t,r,i)=>{e.propertyDirectivesCallback(t,r,i)}),this.parser.onClassDirective((t,r,i)=>{e.classDirectiveCallback(t,r,i)})}bindElement(e,t,r={}){if(!this.isStateCompatible(t))throw new Error(`State is not compatible with bridge ${this.constructor.name}`);this.boundElements.has(e)&&this.unbindElement(e);let i=this.parser.processElement(e,t,r);return this.boundElements.set(e,i.context),{context:i.context,directives:i.directives,dispose:()=>this.unbindElement(e)}}unbindElement(e){let t=this.boundElements.get(e);t&&(t.dispose(),this.boundElements.delete(e))}dispose(){for(let[e]of this.boundElements)this.unbindElement(e)}isStateCompatible(e){return console.warn("Method must be implemented by subclass"),!1}attributeDirectivesCallback(e,t,r){console.log("Attribute directives found:",t),console.warn("Method must be implemented by subclass")}classDirectiveCallback(e,t,r){console.log("Class directive found:",t),console.warn("Method must be implemented by subclass")}propertyDirectivesCallback(e,t,r){console.log("Property directives found:",t),console.warn("Method must be implemented by subclass")}modelDirectiveCallback(e,t,r){console.log("Model directive found:",t),console.warn("Method must be implemented by subclass")}behaviorDirectiveCallback(e,t,r){console.log("Behavior directives found:",t),console.warn("Method must be implemented by subclass")}};export{M as BridgeBase,v as ClassDirectiveValue,l as DIRECTIVE_PREFIXES,b as DirectiveParser,u as DirectiveValue,d as ParsedDirectives,g as attributeNameToPropertyName,x as getElementAttrs,y as getPropertyValue,C as isValidForTwoWayBinding,R as parseDirectives,I as pathToPropertyName,L as propertyNameToAttributeName,h as propertyNameToPath};
